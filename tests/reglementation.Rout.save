
R version 3.5.2 (2018-12-20) -- "Eggshell Igloo"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library (Qair)
Loading required package: timetools
Loading required package: DBI
> options(Xair.host = '172.16.16.16',
+ 	Xair.dsn = 'N09',
+ 	Xair.uid = 'vlad',
+ 	Xair.pwd = 'vlad',
+ 	Xair.drv='oracle')
> 
> # test des calculs de valeurs réglementaires
> #===========================================
> # les calculs tests sont basés sur le réseau de mesure
> # de la qualité de l'air de La Rochelle au cours de l'année 2011
> # (à l'exception du CO qui n'est plus mesuré depuis longtemps)
> 
> stations<- c('VERDUN', 'AYTRE', 'VAUGOI', 'STLOUIS_LR')
> sites	<- 'PLAROC_023'
> debut	<- '2011-01-01'
> fin	<- '2012-01-01'
> xr	<- xrConnect()
> 
> # Les polluants 'continus' (or CO)
> #=================================
> 
> polluants <- c('03', '12', '24', '39', '08', '01')
> for (polluant in polluants)
+ {
+ 	donnees <- xrGetContinuousData (xr, stations=stations, start=debut, end=fin,
+ 					polluants=polluant)
+ 	tmp <- validation.reglementaire (donnees, seuils(polluant=polluant),
+ 					 resultat='comparaison')
+ 	tmp <- lapply (tmp, function(x)
+ 		       if (nrow(x) > 1) lapply (x, sum, na.rm=TRUE) else x)
+ 
+ 	# affichage
+ 	print (xrGetPolluants(xr, search.fields='NOPOL', polluant)$NCON)
+ 	print (tmp)
+ }
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
[1] "Dioxyde d'azote"
[[1]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          0

[[2]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0           0      0      0          0

[[3]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0           0      0      0          0

[[4]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0           0      0      0          0

[[5]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC     FALSE          NA     NA  FALSE      FALSE

[[6]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC     FALSE          NA     NA  FALSE      FALSE

[[7]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC     FALSE          NA     NA  FALSE       TRUE

[[8]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC     FALSE          NA     NA  FALSE      FALSE

[[9]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          0

[[10]]
           start            end NO2_AYTRE NO2_2_AYTRE N2_VA2 N2_VAU NO2_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          0

Simplified splitting algorithm
[1] "Oxydes d azote"
[[1]]
           start            end NOX_AYTRE NOX_2_AYTRE NX_VA2 NX_VAU NOX_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          1

[[2]]
           start            end NOX_AYTRE NOX_2_AYTRE NX_VA2 NX_VAU NOX_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          1

[[3]]
           start            end NOX_AYTRE NOX_2_AYTRE NX_VA2 NX_VAU NOX_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         0          NA     NA      0          1

Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
[1] "PM10"
[[1]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA       0     NA       0             0
  PM10NC_VERDUN PM10_VERDUN
1            NA           0

[[2]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC          0      10      0      10            10
  PM10NC_VERDUN PM10_VERDUN
1             0          10

[[3]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC          0       1      0       1             1
  PM10NC_VERDUN PM10_VERDUN
1             0           1

[[4]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA   FALSE     NA   FALSE         FALSE
  PM10NC_VERDUN PM10_VERDUN
1            NA       FALSE

[[5]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA       0     NA       0             0
  PM10NC_VERDUN PM10_VERDUN
1            NA           0

[[6]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA    TRUE     NA    TRUE          TRUE
  PM10NC_VERDUN PM10_VERDUN
1            NA        TRUE

[[7]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA       1     NA       1             1
  PM10NC_VERDUN PM10_VERDUN
1            NA           1

[[8]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA   FALSE     NA   FALSE         FALSE
  PM10NC_VERDUN PM10_VERDUN
1            NA       FALSE

[[9]]
           start            end PM10_AYTRE X24_VAU PS_VAU X24FVAU PM10_C_VERDUN
1 2011-01-01 UTC 2012-01-01 UTC         NA       0     NA       0             0
  PM10NC_VERDUN PM10_VERDUN
1            NA           0

Simplified splitting algorithm
[1] "PM2.5"
[[1]]
           start            end P2_VAU PM25_VERDUN BC_PMff_VERD BC_PMwb_VERD
1 2011-01-01 UTC 2012-01-01 UTC     NA           1           NA           NA

[[2]]
           start            end P2_VAU PM25_VERDUN BC_PMff_VERD BC_PMwb_VERD
1 2011-01-01 UTC 2012-01-01 UTC     NA           0           NA           NA

[[3]]
           start            end P2_VAU PM25_VERDUN BC_PMff_VERD BC_PMwb_VERD
1 2011-01-01 UTC 2012-01-01 UTC     NA       FALSE           NA           NA

[[4]]
           start            end P2_VAU PM25_VERDUN BC_PMff_VERD BC_PMwb_VERD
1 2011-01-01 UTC 2012-01-01 UTC     NA           0           NA           NA

[[5]]
           start            end P2_VAU PM25_VERDUN BC_PMff_VERD BC_PMwb_VERD
1 2011-01-01 UTC 2012-01-01 UTC     NA           0           NA           NA

Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
[1] "Ozone"
[[1]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC         NA     TRUE         NA     NA   TRUE
  O3_VERDUN O3_2_VERDUN
1      TRUE          NA

[[2]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC         NA       NA         NA     NA      1
  O3_VERDUN O3_2_VERDUN
1         1          NA

[[3]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2009-01-01 UTC 2012-01-01 UTC         NA       NA         NA     NA      0
  O3_VERDUN O3_2_VERDUN
1         0          NA

[[4]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2007-01-01 UTC 2012-01-01 UTC         NA       NA         NA     NA     NA
  O3_VERDUN O3_2_VERDUN
1        NA          NA

[[5]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC          0        0          0      0      0
  O3_VERDUN O3_2_VERDUN
1         0           0

[[6]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC          0        0          0      0      0
  O3_VERDUN O3_2_VERDUN
1         0           0

[[7]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC          0        0          0      0      0
  O3_VERDUN O3_2_VERDUN
1         0           0

[[8]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC          0        0          0      0      0
  O3_VERDUN O3_2_VERDUN
1         0           0

[[9]]
           start            end O3_2_AYTRE O3_AYTRE O3_3_AYTRE O3_VA2 O3_VAU
1 2011-01-01 UTC 2012-01-01 UTC          0        0          0      0      0
  O3_VERDUN O3_2_VERDUN
1         0           0

Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
[1] "Dioxyde de soufre"
[[1]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[2]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC      0           0          0    0

[[3]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC      0           0          0    0

[[4]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[5]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[6]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[7]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2010-10-01 UTC 2012-04-01 UTC      0           0          0    0

[[8]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[9]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[10]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

[[11]]
           start            end S2_VAU SO2_VAUGOIN SO2_VERDUN test
1 2011-01-01 UTC 2012-01-01 UTC     NA          NA         NA   NA

> 
> # le monoxyde de carbone CO
> #==========================
> 
> polluant <- '04'
> donnees <- xrGetContinuousData (xr, stations=stations, start='2004-01-01',
+ 				end='2005-01-01', polluants=polluant)
> tmp <- validation.reglementaire (donnees, seuils(polluant=polluant),
+ 				 resultat='comparaison')
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
Simplified splitting algorithm
> tmp <- lapply (tmp, function(x)
+ 	       if (nrow(x) > 1) lapply (x, sum, na.rm=TRUE) else x)
> print (xrGetPolluants(xr, search.fields='NOPOL', polluant)$NCON)
[1] "Monoxyde de carbone"
> print(tmp)
[[1]]
           start            end CO_VAUGOUIN CO_A_VAUGOUIN CO_VERDUN CO_2_VERDUN
1 2004-01-01 UTC 2005-01-01 UTC          NA            NA     FALSE          NA

[[2]]
           start            end CO_VAUGOUIN CO_A_VAUGOUIN CO_VERDUN CO_2_VERDUN
1 2004-01-01 UTC 2005-01-01 UTC          NA            NA     FALSE          NA

[[3]]
           start            end CO_VAUGOUIN CO_A_VAUGOUIN CO_VERDUN CO_2_VERDUN
1 2004-01-01 UTC 2005-01-01 UTC          NA            NA     FALSE          NA

> 
> # les polluants manuels
> #======================
> 
> polluants <- c('19', 'V4', '80', '82', '87', 'P6')
> for (polluant in polluants)
+ {
+ 	donnees <- xrGetManualData (xr, start=debut, end=fin, sites=sites,
+ 					polluants=polluant)
+ 	tmp <- validation.reglementaire (donnees, seuils(polluant=polluant),
+ 					 etapes=c('preparation.comparaison',
+ 						  'comparaison'),
+ 					 resultat='detail',
+ 					 rep.b.comparaison = 0.1)
+ 	# on met 0.1 à la place de 0.14 parce que dans le cas présent
+ 	# on est entre 0.11 et 0.13
+ 
+ 	tmp <- lapply (tmp, function(x)
+ 		       if (nrow(x) > 1) lapply (x, sum, na.rm=TRUE) else x)
+ 
+ 	# affichage
+ 	print (xrGetPolluants(xr, search.fields='NOPOL', polluant)$NCON)
+ 	print (tmp)
+ }
[1] "Plomb"
[[1]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.19
1 2011-01-01 UTC 2012-01-01 UTC                                            9.82

[[2]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.19
1 2011-01-01 UTC 2012-01-01 UTC                                            9.82

[[3]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.19
1 2011-01-01 UTC 2012-01-01 UTC                                            9.82

[[4]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.19
1 2011-01-01 UTC 2012-01-01 UTC                                            9.82

[1] "Benzene"
[[1]]
           start            end D17LAR_STLOUIS.TUBE.ACTIF.V4
1 2011-01-01 UTC 2012-01-01 UTC                          1.7

[[2]]
           start            end D17LAR_STLOUIS.TUBE.ACTIF.V4
1 2011-01-01 UTC 2012-01-01 UTC                          1.7

[[3]]
           start            end D17LAR_STLOUIS.TUBE.ACTIF.V4
1 2011-01-01 UTC 2012-01-01 UTC                          1.7

[[4]]
           start            end D17LAR_STLOUIS.TUBE.ACTIF.V4
1 2011-01-01 UTC 2012-01-01 UTC                          1.7

[1] "Arsenic particulaire"
[[1]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.80
1 2011-01-01 UTC 2012-01-01 UTC                                            0.81

[[2]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.80
1 2011-01-01 UTC 2012-01-01 UTC                                            0.81

[[3]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.80
1 2011-01-01 UTC 2012-01-01 UTC                                            0.81

[1] "Cadmium particulaire"
[[1]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.82
1 2011-01-01 UTC 2012-01-01 UTC                                            0.08

[[2]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.82
1 2011-01-01 UTC 2012-01-01 UTC                                            0.08

[[3]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.82
1 2011-01-01 UTC 2012-01-01 UTC                                            0.08

[1] "Nickel particulaire"
[[1]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.87
1 2011-01-01 UTC 2012-01-01 UTC                                            1.29

[[2]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.87
1 2011-01-01 UTC 2012-01-01 UTC                                            1.29

[[3]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.87
1 2011-01-01 UTC 2012-01-01 UTC                                            1.29

[1] "Benzo(a)pyrene particulaire"
[[1]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.P6
1 2011-01-01 UTC 2012-01-01 UTC                                             0.2

[[2]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.P6
1 2011-01-01 UTC 2012-01-01 UTC                                             0.2

[[3]]
           start            end D17LAR_STLOUIS.PRELEVEMENT.1.m3.h.SUR.FILTRE.P6
1 2011-01-01 UTC 2012-01-01 UTC                                             0.2

> 
> # On ferme
> #=========
> 
> dbDisconnect(xr)
[1] TRUE
> 
> proc.time()
   user  system elapsed 
 18.075   0.251  36.369 
